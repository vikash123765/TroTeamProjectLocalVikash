@using MovieShopTrio.Models
@using Newtonsoft.Json
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    // Retrieve the cart data from the session as a string
    var cartString = HttpContextAccessor.HttpContext.Session.GetString("Cart");
    List<CartItemViewModel> cartItems = new List<CartItemViewModel>();

    // If the cart exists in the session, deserialize it into a List of CartItemViewModel
    if (!string.IsNullOrEmpty(cartString))
    {
        cartItems = JsonConvert.DeserializeObject<List<CartItemViewModel>>(cartString);
    }
}

<h2>Your Cart</h2>

@if (cartItems.Count == 0)
{
    <p>Your cart is empty.</p>
}
else
{
    <ul>
        @foreach (var cartItem in cartItems)
        {
            <li>
                <strong>@cartItem.Movie.Title</strong> - @cartItem.Movie.Price.ToString("C")
                @if (cartItem.Quantity > 1)
                {
                    <strong> x @cartItem.Quantity</strong>
                }
                <a href="@Url.Action("RemoveFromCart", "Order", new { movieId = cartItem.Movie.Id })">Remove</a>
            </li>
        }
    </ul>

    <h3>Total: @cartItems.Sum(item => item.Movie.Price * item.Quantity).ToString("C")</h3>
}

<a href="@Url.Action("GetAllMovies", "Movie")">Continue Shopping</a>


<!-- Checkout Section -->
<h3>Checkout</h3>
<form id="checkoutForm" method="post" action="@Url.Action("Checkout", "Order")">
    <!-- Email input with placeholder -->
    <div class="form-group">
        <label for="email">Enter your email address to checkout</label>
        <input type="email" id="email" name="email" class="form-control" placeholder="Email Address" required />
    </div>

    <!-- Checkout Button -->
    <button type="submit" class="btn btn-primary" id="checkoutButton">Checkout</button>
</form>

